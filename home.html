<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
  <link rel="stylesheet" href="home.css">
  <title>home</title>
</head>
<body>
  
  
  <nav>
    <div class="nav-left">
      <div class="nav-img ">
      <img src="logo-circle.png ">
    </div>
    </div>
    <div class="nav-middle ">
      <div class="nav-icon-box">
        <div id="homeNav" class="nav-icon ">
        <img  id="homeGray" src="home.png">
        <img id="homeBlue" src="home-blue.png">
      </div>
      <div id="profileNav" class="nav-icon ">
        <img  id="profileGray" src="profile.png">
        <img  id="profileBlue" src="profile-blue.png">
      </div>
      <div id="notificationNav" class="nav-icon ">
        <img  id="notiGray" src="notification.png">
        <img  id="notiBlue" src="notafication-blue.png">
      </div>
      </div>
      <div class="underline"></div>
    </div>
    
    <div class="nav-right">
      <div class="search-icon-box">
        <i class='bx bx-search'></i>
      </div>
      <div class="profile-circle " onclick="toggleDropdown()">
      <img class="profile-img">
    </div>
    </div>
    
    
  </nav>
  
  <div class="mobail-nav">
    <div class="nav-top">
      <img src="logo-blue.png">
    </div>
    <div class="nav-bottom">
      
      <div class="navMDisplayFlex">
        <a href="#" >
      <div id="homNavM" class="nav-mobail">
        <img id="homeBlueM" src="home-blue.png">
        <img id="homeGrayM" src="home.png">
        <div class="newFeedNotification">+</div>
      </div>
      </a>
      <a href="#">
      <div id="profileNavM" class="nav-mobail">
        <img  id="profileGrayM" src="profile.png">
        <img id="profileBlueM" src="profile-blue.png">
      </div>
      </a>
      <a href="#">
      <div id="notiNavM" class="nav-mobail">
        <img  id="notiGrayM" src="notification.png">
        <img  id="notiBlueM" src="notafication-blue.png">
      </div>
      </a>
      <a href="#">
      <div id="menuNavM" class="nav-mobail">
        <div class="nav-menu">
          <img class="profile-img">
        </div>
      </div>
      </a>
      </div>
      
       <div class="mUnderline"></div>
    </div>
  </div>
  
  
  <div class="drop-down-menu " id="dropdownMenu">
    
    <div class="user-profile-and-name ">
      <div class="menu-profile ">
        <img class="profile-img lazyload">
      </div>
      <h4 class="greet"></h4>
    </div>
    <div class="menu-item ">
      <img src="setting.png ">
      <h4>Settings & privacy</h4>
      <img id="menu-arrowPng" src="arrow.png ">
    </div>
    <div class="menu-item ">
      <img src="help.png ">
      <h4>Help & support</h4>
      <img id="menu-arrowPng" src="arrow.png ">
    </div>
    <div class="menu-item ">
      <img src="display.png ">
      <h4>Display & accessibility</h4>
      <img id="menu-arrowPng" src="arrow.png ">
    </div>
    <div class="menu-item ">
      <img src="feedback.png ">
      <h4>Give feedback</h4>
    </div>
    <div class="menu-item logout-btn">
      <img src="logout.png ">
      <h4>Log Out</h4>
    </div>
  </div>
  
     <div class="dropdown-search-box">
      <div class="search-inp">
        <input type="search" placeholder="Search Socialbook">
      </div>
      <div class="search-content-box">
        <div class="search-user-box">
          <div class="search-user-profile"></div>
          <div class="search-user-name">
            <h4>User Name</h4>
            <p>user</p>
          </div>
        </div>
      </div>
    </div>




  <div class="main-container">
    <div class="left-sidebar"></div>
   <div class="main-content">
     <div class="post-create-container ">
       <div class="post-create-profile-box">
         <div class="post-create-profile">
           <img class="profile-img lazyload">
         </div>
       </div>
     <div class="textarea ">
         <p id="postTextarea">What do you think?</p>
       </div>
    </div>
    
    
    
    
    
    
    
    
    
    
    
    
    <!---<div class="post-upload-pogress-container">
      <img src="post.jpg">
      <p>Posting...</p>
      <span class="imgUpProgress"></span>
    </div>--->
    
    <audio id="postSound" src="post-sound.mp3" preload="auto"></audio>
    
<!--<div class="post ">
      <div class="post-header_and_post_content">
        <div class="profile-box ">
          <div class="post-profile">
         <img src="post.jpg ">
       </div>
     </div>
     <div class="post-userName-andtime">
       <h4>Lazim Mahmud</h4>
       
     </div>
     <div class="post-menu">
       <i class='bx bx-dots-vertical-rounded'></i>
     </div>
           </div>
         <div class="post-text ">
       <p>hello world welcome to socialbook and this is a social media platform in the world</p>
   </div>
 <div class="post-img ">
  <img src="post.jpg" id="databaseImg">
    </div>
      <div class="post-activity-container">
       <div class="post-activity-box ">
         <div onclick="toggleLike()" class="like-box ">
            <img id="likeGray" src="like.png">
              <img id="likeBlue" src="like-blue.png">
             <h4 id="likeText">Like</h4>
           </div>
         <div class="like-box ">
       <img src="comment.png">
     <h4>Comment</h4>
   </div>
     <div class="like-box ">
      <img src="share.png">
        <h4>Share</h4>
          </div>
             </div>
               </div>
          <div class="coment-display-container">
            
         
           <div class="user-coment-box">
              <div class="user-comment-profile">
                <img class="profile-img">
              </div>
              <div class="coment-content">
                <h4></h4>
                <p></p>
              </div>
              
            </div>
            
          </div>
          
         <div class="post-comment-container">
           <div class="comment-profile">
             <img class="profile-img">
           </div>
           <div class="comment-inp-box">
             <input type="text" placeholder="Write a public comment...">
           </div>
           <button class="comment-send-button" type="button"><i class='bx bxs-send' ></i></button>
         </div>
               
      </div>--->
      
    <!---- <div class="post ">
      <div class="post-header_and_post_content">
              <div class="profile-box ">
                <div class="post-profile">
                   <img src="no-profile.png">
                </div>
              </div>
              <div class="post-userName-andtime">
                <h4>Lazim Mahmud <span class="update-profile-text">Update his profile picture.</span></h4>
                <p class="span" id="post-time-${postId}">1m ago <span>•</span><span> <i class='bx bx-world'></i></span></p>
              </div>
              <div class="post-menu">
                <i class='bx bx-dots-vertical-rounded'></i>
              </div>
            </div>
       <div class="profile-post-img ">
          <div class="profileImgCircle">
           <img src="profile.jpg" id="databaseImg">
        </div>
      </div>
      <div class="post-activity-container">
       <div class="post-activity-box ">
         <div onclick="toggleLike()" class="like-box ">
            <img id="likeGray" src="like.png">
              <img id="likeBlue" src="like-blue.png">
             <h4 id="likeText">Like</h4>
           </div>
         <div class="like-box ">
       <img src="comment.png">
     <h4>Comment</h4>
   </div>
     <div class="like-box ">
      <img src="share.png">
        <h4>Share</h4>
          </div>
             </div>
               </div>
               
      </div>----->
      
              
        
    <div class="loading-post-container">
    <div class="loading-post">
       <div class="loading-profile-header">
         <div class="loading-profile"></div>
         <div class="bar-container">
           <div class="loading-bar"></div>
         <div style="margin-top: 9px; width: 35%;" class="loading-bar"></div>
         </div>
       </div>
     <div class="loading-bottom-bar">
           <div class="bar"></div>
           <div class="bar"></div>
           <div class="bar"></div>
         </div>
   </div>
   <div class="loading-post">
       <div class="loading-profile-header">
         <div class="loading-profile"></div>
         <div class="bar-container">
           <div class="loading-bar"></div>
         <div style="margin-top: 9px; width: 35%;" class="loading-bar"></div>
         </div>
       </div>
     <div class="loading-bottom-bar">
           <div class="bar"></div>
           <div class="bar"></div>
           <div class="bar"></div>
         </div>
   </div>
    
    
  </div>
     
              
   </div>
    
    <div class="right-sidebar"></div>
  </div>
  
  <div class="profile-page-container">
    <div class="profile-page ">
      <div class="profile-into-container ">
        <div class="cover-photo-container ">
          <img class="cover-img">
        </div>
        <div class="profile-photo-circle">
  <img class="profile-img">
</div>
        <button type="button" class="Edit-profile-btn ">Edit profile</button>
        <div class="profile-name-box ">
          <h3 class="greet "></h3>
          <p id="accountEmail"></p>
        </div>
        <div class="bio-container ">
          <p>Hello friend's welcome to my Socialbook account</p>
        </div>
        <div class="follower-container ">
          <p><span class="follow-count">0</span> Following</p>
          <p>•</p>
          <p><span class="follow-count">0</span> Followers</p>
        </div>
      </div>
      <div class="profile-page-post">
        
      </div>
    </div>
  </div>
  
  <div class="menu-page-container">
    <div class="menu-page">
      <h4>Menu</h4>
      <div class="menu-profile-cird">
        <div class="menu-profile-circle">
          <img class="profile-img">
        </div>
        <span class="menu-profile-name">
          <h4 style="font-size: 14px;" class="greet"></h4>
        </span>
      </div>
      <button type="button" class="lg-btn-menu">Log out</button>
    </div>
    
    <div class="logout-popup-opachity">
      <div class="lg-popup">
        <p>Log out of your account?</p>
        <div class="lg-two-btn-box">
        <button type="button" class="calcleBtn">CANCEL</button>
        <button type="button" class="lg logout-btn">Log out</button>
      </div>
      </div>
    </div>
  </div>
 
 
 
  <div class="edit-profile-popup-opachity ">
    
    <div class="edit-profile-popup ">
      <div class="edit-profile-popup-header ">
        <h4>Edit Profile</h4>
        <i class='bx bx-x-circle'></i>
      </div>
     <div class="popup-content-box ">
       <label for="coverImgInp">
        <div class="edit-profile-cover-box ">
          <i class='bx bxs-camera'></i>
        <img id="coverImgSelect">
        <input type="file" id="coverImgInp" accept="image/*" style="display: none;" >
      </div>
      </label>
      <label for="profileInp">
      <div class="edit-profile-box ">
         <i class='bx bxs-camera'></i>
        <img id="profileImgSleted">
        <input type="file" id="profileInp" accept="image/*" style="display: none;" >
      </div>
      </label>
      <br>
      <br>
      <br>
      <br>
      <br>
      <br>
      <div class="edit-input-box ">
        <input id="editName" type="text" placeholder="Name ">
      </div>
      <div class="edit-input-box ">
        <input type="text" placeholder="Bio ">
      </div>
      <div class="save-btn-container ">
        <button type="button" class="edit-save-btn">Save</button>
      </div>
     </div>
    </div>
    
  </div>
  
  <div class="popup-opachity "> 
    <div class="post-create-popup ">
      <div class="post-create-header ">
        <h4>Create post</h4>
        <i class='bx bx-x-circle'></i>
      </div>
      <div class="popup-content-box ">
        <div class="popup-profile-box ">
          <div class="popup-profile ">
            <img class="profile-img">
          </div>
          <h4 class="greet"></h4>
        </div>
        <div class="post-text-input ">
          <textarea id="textareaPlaceholder" cols="3" rows="3" placeholder="What do you think"></textarea>
        </div>
        <label for="fileInput">
        <div class="post-img-select-box ">
          <div class="img-select-icon ">
            <div class="icon-box ">
              <i class='bx bxs-image'></i>
            </div>
              <h4>Add Photos</h4>
          </div>
          <input type="file" id="fileInput" accept="image/*" style="display: none;" >
          <img id="selectedImage" >
        </div>
        </label>
        <button class="postBtn" id="uploadBtn">POST</button>
      </div>
    </div>
  </div>
  
  
  

    <script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
  import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-storage.js";
  import { getDatabase, ref as dbRef, set, get,remove, onChildAdded, onChildRemoved, update, onChildChanged } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-database.js";
  
  const firebaseConfig = {
    apiKey: "AIzaSyDLiT3pWoHy1IK3StGdJQsiVndCSgl7XB8",
    authDomain: "socialbook-69ec5.firebaseapp.com",
    databaseURL: "https://socialbook-69ec5-default-rtdb.firebaseio.com",
    projectId: "socialbook-69ec5",
    storageBucket: "socialbook-69ec5.appspot.com",
    messagingSenderId: "720368891227",
    appId: "1:720368891227:web:ba2f4111a3b15ece5b967e"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const storage = getStorage(app);
  const database = getDatabase(app);





  document.getElementById('fileInput').addEventListener('change', function(event) {
  const file = event.target.files[0];
  if (file) {
    const reader = new FileReader();
    reader.onload = function(e) {
      document.getElementById('selectedImage').src = e.target.result;
    };
    reader.readAsDataURL(file);
  }
});
  
  document.getElementById('uploadBtn').addEventListener('click', function () {
  const text = document.getElementById('textareaPlaceholder').value;
  const fileInput = document.getElementById('fileInput');
  const file = fileInput.files[0];

  if (text || file) {
    setTimeout(function () {
      const popupOpachityElement = document.querySelector('.popup-opachity');
      if (popupOpachityElement) {
        popupOpachityElement.style.display = 'none';
        document.querySelector('.mobail-nav').style.zIndex = '1';
      }
    }, 10);

    const userId = 'user123'; // Replace with actual user ID
    const userFirstName = UserInfo.firstName;
    const userLastName = UserInfo.lastName;
    const postId = new Date().getTime(); // Unique post ID based on timestamp
    const uploadTime = new Date().toISOString(); // Save current time

    let imageUrl = '';
    let profileImageUrl = '';

    // Create the post upload progress container
    const progressContainer = document.createElement('div');
    progressContainer.className = 'post-upload-pogress-container';
    const progressImage = document.createElement('img');
    const progressText = document.createElement('p');
    progressText.textContent = 'Posting...';

    if (file) {
      const reader = new FileReader();
      reader.onload = function (e) {
        progressImage.src = e.target.result;
      };
      reader.readAsDataURL(file);
    } else {
      progressImage.src = '';
    }

    const progressBar = document.createElement('span');
    progressBar.className = 'imgUpProgress';

    progressContainer.appendChild(progressImage);
    progressContainer.appendChild(progressText);
    progressContainer.appendChild(progressBar);
    const postCreateContainer = document.querySelector('.post-create-container');
    postCreateContainer.insertAdjacentElement('afterend', progressContainer);

    // Function to simulate progress
    let progress = 0;
    const simulateProgress = setInterval(() => {
      if (progress < 100) {
        progress += 5; // Increment progress (adjust speed here)
        progressBar.style.background = `conic-gradient(var(--main-color) ${progress}%, transparent 0)`; // Simulate the fill
      } else {
        clearInterval(simulateProgress); // Stop progress animation when complete
      }
    }, 200); // Speed of the progress increment

    // Function to handle image upload
    const uploadImage = () => {
      return new Promise((resolve, reject) => {
        if (file) {
          const storageRef = ref(storage, 'images/' + postId + '-' + file.name);
          uploadBytes(storageRef, file)
            .then((snapshot) => {
              getDownloadURL(snapshot.ref)
                .then((url) => {
                  imageUrl = url;
                  clearInterval(simulateProgress); // Stop progress when upload is complete
                  progressBar.style.background = `conic-gradient(var(--main-color) 100%, transparent 0)`; // Complete progress fill
                  resolve();
                })
                .catch(reject);
            })
            .catch(reject);
        } else {
          resolve();
        }
      });
    };

    // Fetch profile image from Firebase Realtime Database
    const fetchProfileImage = () => {
      return new Promise((resolve, reject) => {
        let UserCreds = JSON.parse(localStorage.getItem('user-creds'));
        if (UserCreds && UserCreds.email) {
          const email = UserCreds.email;
          const formattedEmail = email.replace('.', ','); // Format email for database key
          const userProfileDetailsRef = dbRef(database, 'User_Profile_details/' + formattedEmail);

          get(userProfileDetailsRef)
            .then((snapshot) => {
              if (snapshot.exists()) {
                const data = snapshot.val();
                if (data.profileImageURL) {
                  profileImageUrl = data.profileImageURL;
                }
                resolve();
              } else {
                console.log('No profile details found for this user.');
                resolve(); // Resolve even if no data found
              }
            })
            .catch((error) => {
              console.error('Error fetching profile image:', error);
              reject(error);
            });
        } else {
          console.error('No user credentials found in local storage.');
          resolve(); // Resolve even if no user credentials
        }
      });
    };

    // Save text and user details to Firebase Realtime Database
    Promise.all([uploadImage(), fetchProfileImage()])
      .then(() => {
        return set(dbRef(database, 'All_Post/' + postId), {
          userId: userId,
          firstName: userFirstName,
          lastName: userLastName,
          text: text,
          timestamp: postId,
          uploadTime: uploadTime,
          imageUrl: imageUrl,
          profileImageUrl: profileImageUrl,
        });
      })
      .then(() => {
        document.getElementById('textareaPlaceholder').value = '';
        document.getElementById('fileInput').value = '';
        document.getElementById('selectedImage').src = '';
        document.querySelector('.post-upload-pogress-container').style.display = 'none'; // Hide progress container

        // Play the post upload sound
        const postSound = document.getElementById('postSound');
        postSound.play();
      })
      .catch((error) => {
        console.error('Error creating post: ', error);
      });
  } else {
    alert('Please write something or select an image before posting.');
  }
});


// Fetch and display posts when the page loads
window.addEventListener('load', () => {
    const loadingContainer = document.querySelector('.loading-post-container');
    loadingContainer.style.display = 'block';

    let initialLoadCompleted = false;
    const newFeedNotification = document.querySelector('.newFeedNotification');

    // Function to handle new posts
    const handleNewPost = () => {
        if (localStorage.getItem('notificationHidden') !== 'true') {
            newFeedNotification.style.display = 'block';
        }
    };

    // Check local storage to hide notification if it was previously hidden
    if (localStorage.getItem('notificationHidden') === 'true') {
        newFeedNotification.style.display = 'none';
    }

    // Function to update post times
    const updatePostTimes = () => {
        // Your existing logic to update post times
    };

    // Function to check if there are no posts
    const checkNoPosts = () => {
        const postContainer = document.querySelector('.post-create-container');
        const posts = postContainer.querySelectorAll('.post');
        if (posts.length === 0) {
            loadingContainer.style.display = 'block';
        }
    };

    // Listen for new posts and add them to the DOM
    onChildAdded(dbRef(database, 'All_Post'), (snapshot) => {
        if (snapshot.exists()) {
            const post = snapshot.val();
            const postId = snapshot.key;
            const postContainer = document.querySelector('.post-create-container');

            if (document.getElementById(`post-${postId}`)) {
                return;
            }

            // Show the new feed notification if the user has not hidden it
            handleNewPost();

            const postElement = document.createElement('div');
            postElement.className = 'post';
            postElement.id = `post-${postId}`;

            const imageHTML = post.imageUrl ? `<div class="post-img"><img src="${post.imageUrl}" class="lazyload" id="databaseImg"></div>` : '';
            const profileImageHTML = post.profileImageUrl
                ? `<img src="${post.profileImageUrl}">`
                : `<img src="no-profile.png">`;

            postElement.innerHTML = `
                <div class="post-header_and_post_content">
                    <div class="profile-box">
                        <div class="post-profile">
                            ${profileImageHTML}
                        </div>
                    </div>
                    <div class="post-userName-andtime">
                        <h4>${post.firstName} ${post.lastName}</h4>
                        <p class="span" id="post-time-${postId}" data-upload-time="${post.uploadTime}">${formatRelativeTime(post.uploadTime)} <span>•</span><span> <i class='bx bx-world'></i></span></p>
                    </div>
                    <div class="post-menu">
                        <i class='bx bx-dots-vertical-rounded'></i>
                    </div>
                </div>
                <div class="post-text">
                    <p>${post.text.replace(/\n/g, '<br>')}</p>
                </div>
                ${imageHTML}
                <div class="post-activity-container">
                    <div class="post-activity-box">
                        <div onclick="toggleLike('${postId}')" class="like-box" id="like-box-${postId}">
                            <img id="likeGray-${postId}" src="like.png">
                            <img id="likeBlue-${postId}" src="like-blue.png" style="display:none;">
                            <h4 id="likeText-${postId}">Like</h4>
                        </div>
                        <div class="like-box">
                            <img src="comment.png">
                            <h4>Comment</h4>
                        </div>
                        <div class="like-box">
                            <img src="share.png">
                            <h4>Share</h4>
                        </div>
                    </div>
                </div>
                <div class="post-comment-container">
                    <div class="comment-profile">
                        <img class="profile-img">
                    </div>
                    <div class="comment-inp-box">
                        <input type="text" placeholder="Add a comment...">
                    </div>
                    <button class="comment-send-button" type="button"><i class='bx bxs-send'></i></button>
                </div>`;

            postContainer.insertAdjacentElement('afterend', postElement);

            // Hide the loading container only once, after the first post is added
            if (!initialLoadCompleted) {
                loadingContainer.style.display = 'none';
                initialLoadCompleted = true;
            }

            // Clear notification hidden status when a new post is added
            localStorage.removeItem('notificationHidden');

            setInterval(updatePostTimes, 60000);
        }
    }, (error) => {
        console.error("Error fetching posts with onChildAdded: ", error);
    });

    onChildRemoved(dbRef(database, 'All_Post'), (snapshot) => {
        const postId = snapshot.key;

        const postElement = document.getElementById(`post-${postId}`);
        if (postElement) {
            postElement.remove();
        }

        checkNoPosts();
    }, (error) => {
        console.error("Error fetching posts with onChildRemoved: ", error);
    });

    // Hide notification on click and set localStorage to remember
    newFeedNotification.addEventListener('click', () => {
        newFeedNotification.style.display = 'none';
        localStorage.setItem('notificationHidden', 'true');
    });

    // Hide notification on homNavM click
    document.querySelector('#homNavM').addEventListener('click', () => {
        newFeedNotification.style.display = 'none';
        localStorage.setItem('notificationHidden', 'true');
    });

    // Optionally, hide the notification when the user scrolls to the posts section
    window.addEventListener('scroll', () => {
        const postContainer = document.querySelector('.post-create-container');
        const postContainerPosition = postContainer.getBoundingClientRect().top;
        if (postContainerPosition < window.innerHeight) {
            newFeedNotification.style.display = 'none';
            localStorage.setItem('notificationHidden', 'true');
        }
    });
});




// Lazy loading with IntersectionObserver
document.addEventListener("DOMContentLoaded", function() {
  const lazyImages = [].slice.call(document.querySelectorAll("img.lazyload"));

  if ("IntersectionObserver" in window) {
    let lazyImageObserver = new IntersectionObserver(function(entries, observer) {
      entries.forEach(function(entry) {
        if (entry.isIntersecting) {
          let lazyImage = entry.target;
          lazyImage.src = lazyImage.dataset.src;
          lazyImage.classList.remove("lazyload");
          lazyImageObserver.unobserve(lazyImage);
        }
      });
    });

    lazyImages.forEach(function(lazyImage) {
      lazyImageObserver.observe(lazyImage);
    });
  } else {
    // Fallback for older browsers
    lazyImages.forEach(function(lazyImage) {
      lazyImage.src = lazyImage.dataset.src;
      lazyImage.classList.remove("lazyload");
    });
  }
});



function formatRelativeTime(isoDate) {
  const now = new Date();
  const postTime = new Date(isoDate);
  const diffInSeconds = Math.floor((now - postTime) / 1000);

  const options = {
    weekday: 'short', // sat, sun
    month: 'short',   // Aug, Sep
    day: 'numeric',   // 17, 18
    hour: 'numeric',  // 12
    minute: 'numeric', // 30
    hour12: true      // PM, AM
  };

  if (diffInSeconds < 60) return `Just now`;  // পরিবর্তিত অংশ
const diffInMinutes = Math.floor(diffInSeconds / 60);
if (diffInMinutes < 60) return `${diffInMinutes}m ago`;
const diffInHours = Math.floor(diffInMinutes / 60);
if (diffInHours < 24) return `${diffInHours}h ago`;
const diffInDays = Math.floor(diffInHours / 24);
if (diffInDays <= 5) return `${diffInDays}d ago`;

  // If more than 5 days, show formatted date
  return postTime.toLocaleDateString('en-US', options);
}

// Function to update post times in real-time
function updatePostTimes() {
  const allPostTimes = document.querySelectorAll('[id^="post-time-"]');
  allPostTimes.forEach(postTimeElement => {
    const postTime = postTimeElement.getAttribute('data-upload-time');
    if (postTime) {
      // Check if the post time is being updated correctly
      postTimeElement.innerHTML = `${formatRelativeTime(postTime)} <span>•</span><span> <i class='bx bx-world'></i></span>`;
    }
  });
}


  
  
  
  // profile and cover image upload 
  document.querySelector('.edit-save-btn').addEventListener('click', async () => {
    const profileFile = document.getElementById('profileInp').files[0];
    const coverFile = document.getElementById('coverImgInp').files[0];

    let UserCreds = JSON.parse(localStorage.getItem("user-creds"));
    if (UserCreds && UserCreds.email) {
        const email = UserCreds.email;
        const formattedEmail = email.replace('.', ',');
        const userProfileDetailsRef = dbRef(database, 'User_Profile_details/' + formattedEmail);

        try {
            // Fetch the current data to preserve any existing values
            const snapshot = await get(userProfileDetailsRef);
            let currentData = {};
            if (snapshot.exists()) {
                currentData = snapshot.val();
            }

            let profileDownloadURL;
            let coverDownloadURL;

            // Update Profile Image if a new one is provided
            if (profileFile) {
                const profileImgRef = ref(storage, 'profileImages/' + profileFile.name);
                const uploadResult = await uploadBytes(profileImgRef, profileFile);
                profileDownloadURL = await getDownloadURL(uploadResult.ref);
                currentData.profileImageURL = profileDownloadURL;
            }

            // Update Cover Image if a new one is provided
            if (coverFile) {
                const coverImgRef = ref(storage, 'coverImages/' + coverFile.name);
                const coverUploadResult = await uploadBytes(coverImgRef, coverFile);
                coverDownloadURL = await getDownloadURL(coverUploadResult.ref);
                currentData.coverImageURL = coverDownloadURL;
            }

            // Save the updated data back to the database
            await set(userProfileDetailsRef, currentData);

            alert('Profile and/or cover images updated successfully!');

            // Update all images with class "profile-img" if profile image was updated
            if (profileDownloadURL) {
                const profileImgs = document.querySelectorAll('.profile-img');
                profileImgs.forEach(img => {
                    img.src = profileDownloadURL;
                });
            }

            // Update all images with class "cover-img" if cover image was updated
            if (coverDownloadURL) {
                const coverImgs = document.querySelectorAll('.cover-img');
                coverImgs.forEach(img => {
                    img.src = coverDownloadURL;
                });
            }

        } catch (error) {
            console.error('Error uploading images:', error);
        }
    } else {
        console.error('No email found in user creds.');
    }
});
  
  
  // profile and cover photo fetch 
  const loadProfileAndCoverImages = async () => {
    let UserCreds = JSON.parse(localStorage.getItem("user-creds"));
    if (UserCreds && UserCreds.email) {
        const email = UserCreds.email;
        const formattedEmail = email.replace('.', ','); // Format email for database key
        const userProfileDetailsRef = dbRef(database, 'User_Profile_details/' + formattedEmail);

        try {
            const snapshot = await get(userProfileDetailsRef);
            if (snapshot.exists()) {
                const data = snapshot.val();
                
                // Load Profile Image
                if (data.profileImageURL) {
                    const profileImageURL = data.profileImageURL;
                    const profileImages = document.querySelectorAll('.profile-img');
                    profileImages.forEach(img => {
                        img.src = profileImageURL;
                    });
                } else {
                    console.log('No profile image found for this user.');
                }

                // Load Cover Image
                if (data.coverImageURL) {
                    const coverImageURL = data.coverImageURL;
                    const coverImages = document.querySelectorAll('.cover-img');
                    coverImages.forEach(img => {
                        img.src = coverImageURL;
                    });
                } else {
                    console.log('No cover image found for this user.');
                }
            } else {
                console.log('No profile details found for this user.');
            }
        } catch (error) {
            console.error('Error fetching profile and cover image URLs:', error);
        }
    } else {
        console.error('No user credentials found in local storage.');
    }
};

window.addEventListener('load', loadProfileAndCoverImages);
  
  
</script>
  
  
  
  
  <script>
    let UserCreds = JSON.parse(localStorage.getItem("user-creds"));
    let UserInfo = JSON.parse(localStorage.getItem("user-info"));

    let MsgHead = document.getElementById('accountEmail');
    let GreetHeads = document.querySelectorAll('.greet'); // Select all elements with class 'greet'
    let LogOutBtns = document.querySelectorAll('.logout-btn');
    let PostTextarea = document.getElementById('postTextarea');
    let textareaPlaceholder = document.getElementById('textareaPlaceholder');
    let nameInput = document.getElementById('editName');

    let logOut = () => {
        localStorage.removeItem("user-creds");
        localStorage.removeItem("user-info");
        window.location.href = 'index.html';
    }

    let CheckCred = () => {
        if (!localStorage.getItem("user-creds")) {
            window.location.href = 'index.html';
        } else {
            MsgHead.innerText = `${UserCreds.email}`;
            GreetHeads.forEach(element => {
                element.innerText = `${UserInfo.firstName} ${UserInfo.lastName}`;
            });
            // Set the placeholder text with user's first name
            PostTextarea.innerText = `What do you think, ${UserInfo.firstName}?`;
            textareaPlaceholder.placeholder = `What do you think, ${UserInfo.firstName}?`
            nameInput.value = `${UserInfo.firstName} ${UserInfo.lastName}`;
        }
    }

    window.addEventListener('load', CheckCred);

    // Add event listener to all logout buttons
    LogOutBtns.forEach(btn => {
        btn.addEventListener('click', logOut);
    });
</script>
  <script src="script.js"></script>
</body>
</html>
